<div id="<%= dom_id(@show) %>" class="d-flex flex-column full-height">
  <!-- Row 1: Text -->
  <div class="container-fluid py-3 template-heading ">
    <p class="h1 text-center">
      Vote
    </p>
  </div>

  <%= render 'logo', show: show %>

  <div class="container-fluid text-warning d-flex flex-column fill-remaining align-items-center template-dark-page">
    <div class="mt-3 col-12 col-sm-9 col-md-6 col-lg-5">
      <% if @poll.subtitle %>
        <p class="h5 text-center mb-0 pb-0">
          <%= @poll.subtitle %>
        </p>
      <% end %>
      <p class="h1 text-center">
        <%= @poll.question %>
      </p>
    </div>
    
    <% if current_attendee.voted_for(@poll) %>
      <p class="h2 text-large text-center my-auto">
        Vote Submitted
      </p>
    <% else %>
      <%= render 'shared/record_errors', record: @vote %>

      <!-- vote form -->
      <%= form_with model: @vote, local: true, class: "poll-form col-12 col-sm-9 col-md-6 col-lg-4 px-2" do |f| %>
        <%= f.hidden_field :attendee_id, value: @current_attendee.id %>
        <%= f.hidden_field :poll_id, value: @poll.id %>

        <div class="d-grid gap-2" id="choice-buttons">
          <% @poll.choices.each do |choice| %>
            <div class="d-flex align-items-center position-relative">
              <% if choice.image.attached? %>
                <% choice.image.analyze unless choice.image.analyzed? %>
                <% ratio = choice.image.metadata[:width].to_f/choice.image.metadata[:height].to_f %>
                <label for="vote_choice_<%= choice.id %>" class="choice-label">
                  <%= image_tag choice.image.variant(resize_to_fill: [72, 72]), style: "height: 100%; width: 72px", class: "rounded-circle me-3", alt: choice.title %>
                </label>
              <% end %>

              <%= f.radio_button :choice_id, choice.id, class: "visually-hidden", id: "vote_choice_#{choice.id}", required: true %>

              <label for="vote_choice_<%= choice.id %>" class="mb-0 text-center text-white btn template-btn-choice btn-lg w-100 choice-label">
                <div class="text-uppercase"><%= choice.title %></div>
                <% if choice.subtitle.present? %>
                  <div class="text-warning text-uppercase small"><%= choice.subtitle %></div>
                <% end %>
              </label>
            </div>
          <% end %>
        </div>

        <div class="mt-3">
          <%= f.submit "Vote", class: "btn template-btn-vote btn-lg w-100 text-bold text-uppercase", disabled: true, id: "vote-submit" %>
        </div>
      <% end %>

      <!-- end vote form -->

    <% end %>
  </div>
</div>